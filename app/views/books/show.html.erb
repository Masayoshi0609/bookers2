<body>

<main class="mb-auto">



 <div class="container">
 	<div class="row">
 		 <%= render "users/user_info", book: @book, user: @user %>

 		<div class="col-md-8 offset-md-1">
			<h2>Book detail</h2>
				<table class="table table-hover table-inverse">
				 <tbody>
				  <tr>

				   <td>
				   	<%= link_to user_path(@book_detail.user.id) do %>
            		<%= attachment_image_tag @book_detail.user, :profile_image, size: "40x40", format: 'jpeg', fallback: "no_image.jpg"%>
					<% end %>

					<br>
				    <%= link_to user_path(@user.id) do %>
			  		 <%= @user.name %>
				    <% end %>
				   </td>

				   <td>
			 	    <%= link_to book_path(@book_detail.id) do %>
					 <%= @book_detail.title %>
					<% end %>
				   </td>

				   <td>
			  	    <%= @book_detail.body %>
				   </td>

				   <td>
				   	<% if @book_detail.favorited_by?(current_user) %>
				   	 <%= link_to book_favorites_path(@book_detail), method: :delete do %>
				   	  <label class="text-danger">♥<%= @book_detail.favorites.count %></label>
				   	 <% end %>

				   	<% else %>
				   	 <%= link_to book_favorites_path(@book_detail), method: :post do %>
				   	  <label>♡<%= @book_detail.favorites.count %></label>
				   	 <% end %>

				   	<% end %>
				   </td>

				   <td>
				   コメント数:<%= @book_detail.book_comments.count %>
				   </td>

				   <% if @user.id == current_user.id %>

				   <td>
				   	<%= link_to "Edit", edit_book_path(params[:id]), class: "btn btn-sm btn-success" %>
				   </td>

				   <td>
				   	<%= link_to "Destroy", book_path(@book_detail.id), method: :delete, "data-confirm" => "Are you sure?", class: "btn btn-sm btn-danger" %>
				   </td>
				   <% end %>

				  </tr>
				   <% @book_detail.book_comments.each do |book_comment| %>
				  <tr>
				  
				   <td>
				    <%= link_to user_path(book_comment.user.id) do %>
						<%= attachment_image_tag book_comment.user, :profile_image, size: "40x40", format: "jpeg", fallback: "no_image.jpg" %>
						<% end %>
						<p>
						<%= link_to user_path(book_comment.user.id) do %>
			  		    <%= book_comment.user.name %>
				        <% end %>
				    </td>

				    <td>
				   	 <%= book_comment.comment %>
				    </td>
				    <td>
				   	 <% if book_comment.user == current_user %>
				   	 <%= link_to "Destroy", book_book_comment_path(@book_detail, book_comment), method: :delete, "data-confirm" => "Are you sure?", class: "btn btn-sm btn-danger" %>
				   	 <% end %>
				    </td>
				    <% end %>
				   </tr>
				 </tbody>
			    </table>
			     <div class="form-group">
			    	<%= form_with(model:[@book_detail, @book_comment], local: true) do |f| %>
 						<%= f.text_area :comment, class: "form-control" %>
 						<%= f.submit "送信" %>
 					  <% end %>
 					 </div>


					</div>
	    </div>
	</div>
 </div>

</main>

</body>

